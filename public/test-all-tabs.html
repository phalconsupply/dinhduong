<!DOCTYPE html>
<html>
<head>
    <title>Test All Statistics Tabs</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .tab-test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #fff3cd; border-color: #ffc107; }
        h3 { margin-top: 0; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 8px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Test All Statistics Tabs</h1>
    <button onclick="testAllTabs()">Test All Tabs</button>
    <button onclick="clearResults()">Clear Results</button>
    
    <div id="results"></div>

    <script>
        const baseUrl = window.location.origin + '/dinhduong/public';
        
        const tabs = [
            { name: 'Weight-for-Age', endpoint: 'get-weight-for-age' },
            { name: 'Height-for-Age', endpoint: 'get-height-for-age' },
            { name: 'Weight-for-Height', endpoint: 'get-weight-for-height' },
            { name: 'Mean Stats', endpoint: 'get-mean-stats' },
            { name: 'WHO Combined', endpoint: 'get-who-combined' }
        ];

        async function testTab(tab) {
            const resultDiv = document.getElementById('result-' + tab.endpoint);
            resultDiv.className = 'tab-test loading';
            resultDiv.innerHTML = `<h3>${tab.name}</h3><p>Testing...</p>`;

            try {
                const url = `${baseUrl}/admin/statistics/${tab.endpoint}`;
                console.log('Testing URL:', url);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'tab-test success';
                    resultDiv.innerHTML = `
                        <h3>✓ ${tab.name}</h3>
                        <p><strong>Status:</strong> SUCCESS</p>
                        <p><strong>Response Time:</strong> ${response.headers.get('X-Response-Time') || 'N/A'}</p>
                        <p><strong>Data Keys:</strong> ${Object.keys(data.data || {}).join(', ')}</p>
                        <details>
                            <summary>Full Response</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    `;
                } else {
                    resultDiv.className = 'tab-test error';
                    resultDiv.innerHTML = `
                        <h3>✗ ${tab.name}</h3>
                        <p><strong>Status:</strong> FAILED</p>
                        <p><strong>Message:</strong> ${data.message || 'Unknown error'}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.className = 'tab-test error';
                resultDiv.innerHTML = `
                    <h3>✗ ${tab.name}</h3>
                    <p><strong>Status:</strong> ERROR</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <pre>${error.stack}</pre>
                `;
            }
        }

        async function testAllTabs() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            for (const tab of tabs) {
                const resultDiv = document.createElement('div');
                resultDiv.id = 'result-' + tab.endpoint;
                resultDiv.className = 'tab-test loading';
                resultDiv.innerHTML = `<h3>${tab.name}</h3><p>Waiting...</p>`;
                resultsDiv.appendChild(resultDiv);
            }

            for (const tab of tabs) {
                await testTab(tab);
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            console.log('Base URL:', baseUrl);
            console.log('Ready to test tabs');
        });
    </script>
</body>
</html>
